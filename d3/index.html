
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <script src="./d3/d3.min.js" charset="utf-8"></script>

    <title>d3</title>
    <style type="text/css">
    .container{
      padding:10px;
      background: url(./bg.jpg) center no-repeat;
    }
    .radar-wrapper{
      position: relative;
      width:300px;
      height:300px;
      margin:100px auto  10px;
    }
    .radar-item{
      position: absolute;
      text-align: center;
      line-height: 20px;
      height:20px;
      width:100px;
      border-radius: 5px;
      padding:5px;
      color:#666;
      cursor: pointer;
    }
    .radar-item:hover{
      font-weight: bold;
      color:#333;
    }
    .radar-value{
       position: absolute;
       display: block;
       
      text-align: center;
      line-height: 14px;
      height:14px;
      padding: 5px 5px;
      font-weight: bold;
      opacity:0.5;
    
      color:#fff;
      border-radius: 3px;
      cursor: pointer;
    }
    /*.radar-value:hover{
      opacity:1;
    }*/
    
    .radar-value-circle{
      cursor: pointer;
    }
    .time-line{

      margin: 20px auto;
      width:400px;
    }
    .time-line-item{
      position: relative;
      display: inline-block;
      width:15px;
      height:15px;
      background: #2CA9E1;
      margin:5px;
      cursor: pointer;
      
    }
    .time-line-item:hover{
      background: #ffea00;
    }
    .time-line-item-year{
      height:20px;
      background: #D7003a;
    }
    .time-line-item-month{
      height:15px;
      background: #2CA9E1;
    }
    .time-line-tip{
      position: absolute;
      top:-30px;
      color:#FFF;
      padding:5px;
      width: 60px;
      z-index:1;
      text-align: center;
      background: #2CA9E1;
      border-radius: 5px;
      border:1px solid #eee;
      display: none;

    }
    .time-line-tip-year{
      background: #D7003a;
    }
    
    </style>

  </head>

  <body>
    <div class="container">

    <div id="radar-wrapper" class="radar-wrapper">
    
    </div>
    <div id="time-line" class="time-line">
    
    </div>
</div>
    <script type="text/javascript">
      
      //values.reverse();
      var radarItemList = [
        {
          text:"魔兽",
          value:"100"
        },
        {
          text:"lol",
          value:"90"
        },
        {
          text:"拳皇",
          value:"60"
        },
        {
          text:"红警",
          value:"110"
        },
        {
          text:"帝国时代",
          value:"84"
        },
        {
          text:"CS/反恐精英",
          value:"120"
        }
      ];
     function radarBuilder(conf){
        this.init(conf);
     };
     radarBuilder.prototype={
        PI:Math.PI,
        angleList:[0,Math.PI/3,Math.PI*2/3,Math.PI,Math.PI*4/3,Math.PI*5/3],
        radarCircleList:[140,120,100, 80, 60, 40, 20],
        radarItemColor:[
            "#E60033",//红色
            "#2CA9E1",//蓝色
            "#DCCB18",//黄色
            "#00A381",//绿色
            "#EC6800",//橘黄
            "#65318E"//紫色
          ],
        radarR: 140,
        radarItemTextWidth: 100,
        radarItemTextHeight: 20,
        radarItemValueWidth: 100,
        radarItemValueHeight: 14,
        animationTime: 500,
        init:function(radarItemList){
          /*var radarR = 140;
          var radarItemTextWidth = 100;
          var radarItemTextHeight = 20;
          var radarItemValueWidth = 100;
          var radarItemValueHeight = 14;
          var PI = Math.PI;
          var angleList=[0,PI/3,PI*2/3,PI,PI*4/3,PI*5/3];

          var radarCircleList = [140,120,100, 80, 60, 40, 20];
          var radarItemColor = [
            "#E60033",//红色
            "#2CA9E1",//蓝色
            "#DCCB18",//黄色
            "#B8D200",//绿色
            "#EC6800",//橘黄
            "#65318E"//紫色
          ];*/
          this.radarWrapper =  d3.select("#radar-wrapper");
          this.radarWrapper
          .append("svg")
          .attr("id","radar-svg")
          .attr("width","300")
          .attr("height","300")
          .classed("radar-svg",true);
          this.buildRadarCircle();
          this.buildRadarLine();
          this.buildDynamicData(radarItemList);
          this.buildTimeLine();
          
        },
        clear:function(){
          this.radarWrapper.html("");
        },
        buildDynamicData:function(radarItemList,modify){
            var x = [], y = [] ;
            var pointsArr = [];
            var pointsValueArr = [];
            var radarR = this.radarR;
            var radarWrapper = this.radarWrapper;
            var radarItemColor = this.radarItemColor;
            var angleList = this.angleList;
            var radarCircleList = this.radarCircleList;
            var radarItemTextWidth = this.radarItemTextWidth;
            var radarItemTextHeight = this.radarItemTextHeight;
            var radarItemValueWidth = this.radarItemValueWidth;
            var radarItemValueHeight = this.radarItemValueHeight;
            var PI = this.PI;
            var animationTime = this.animationTime;
            var svg = radarWrapper.select("#radar-svg");
            for(var i in radarItemList){
              var v = radarItemList[i].value;
              x[i] = Math.floor(radarR + ( v * Math.sin((PI/3)*i)));
              y[i] = Math.floor(radarR -  v * Math.cos((PI/3)*i));
              pointsArr .push( x[i]+","+y[i]+"");
            }
            var pointsStr = pointsArr.join(" ");
            var radarItemValueObj = (function(){
                var list=[];
                for(var i in radarItemList){
                  list.push({
                    value: radarItemList[i].value,
                    position: { x: x[i], y: y[i] }
                    
                  })
                }
                return list;
            })();
            
            this.buildPolygon(radarItemList , pointsArr,modify);
            this.buildValueCircle( radarItemValueObj,modify);
            this.buildValue (radarItemValueObj,modify);
            this.buildItem(radarItemList,modify);

            
        },
        buildItem:function(radarItemList,modify){
            //draw item
            var radarR = this.radarR;
            var radarItemTextWidth = this.radarItemTextWidth;
            var radarItemTextHeight = this.radarItemTextHeight;
            var radarItemColor = this.radarItemColor;
            var radarWrapper = this.radarWrapper;
            var angleList = this.angleList;
            var radarItemObj = (function(){
              var list=[];
                for(var i in radarItemList){
                  list.push({
                    text: radarItemList[i].text,
                    angle: angleList[i]
                  })
                }
                return list;
            })();

            this.radarItems = radarWrapper.selectAll(".radar-item");
            if(modify){
              this.radarItems.data(radarItemObj);
              return;
            }
            this.radarItems.data(radarItemObj)
            .enter().append('a')
            .classed("radar-item",true)
            .style(
              { 'left': function(d,i){ 
                  return radarR - radarItemTextWidth/2 +  Math.sin(d.angle) * (radarR +radarItemTextWidth/2) + 'px'; 
                },
                'top': function(d,i,that){ 
                  return radarR - radarItemTextHeight/2 - Math.cos(d.angle) * (radarR + radarItemTextHeight) + 'px'; 
                },
                'color':function(d,i){
                  return d3.rgb(radarItemColor[i]).brighter();
                }
              }
            )
            .text(function(d,i){
              return d.text;
            })
            .on("mouseenter",function(d,i){
               d3.select(this)
               .style("background", d3.rgb(radarItemColor[i]).darker())
               .style("color", "#fff");
            })
            .on("mouseleave",function(d,i){
               d3.select(this)
               .style("background", null)
               .style("color", d3.rgb(radarItemColor[i]).brighter());
            })
            
            ;
        },
        buildValue:function(radarItemValueObj, modify){
            var RIGHTPUSH = 0;
            var radarItemColor = this.radarItemColor;
            var radarWrapper = this.radarWrapper;
            this.radarItems = radarWrapper.selectAll(".radar-value");
            if(modify){
              this.radarItems.data(radarItemValueObj);
              return;
            }
            
            this.radarItems.data(radarItemValueObj)
            .enter().append('a')
            .classed("radar-value",true)
            .attr("data-top",function(d) { return d.position.y - parseInt(30); } )
            .style(
              { 'left': function(d,i){ 
                  return d.position.x - RIGHTPUSH + 'px'; 
                },
                'top': function(d,i,that){ 
                  return d.position.y - parseInt(30) + 'px'; 
                },
                
                'background':function(d,i){
                  return radarItemColor[i];
                }
              }
            )
            .text(function(d,i){
              return d.value;
            });
        },
        buildValueCircle:function(radarItemValueObj, modify){
            //draw value
            
            var radarItemColor = this.radarItemColor;
            var radarWrapper = this.radarWrapper;
            var svg = radarWrapper.select("#radar-svg");
            this.radarValueCircles = svg.selectAll(".radar-value-circle");
            if(modify){
              this.radarValueCircles.data(radarItemValueObj);
              return;
            }
            this.radarValueCircles .data(radarItemValueObj)
            .enter().append('svg:circle')
            .classed("radar-value-circle",true)
            
            .attr("cx",function(d){
              return d.position.x 
            })
            .attr("cy",function(d){
              return d.position.y
            })
            .attr("stroke",function(d,i){
                  return radarItemColor[i];
                })
            .attr("stroke-width",2)
            .style("fill","#fff" )
            .style("opacity",0)

            .attr("r",4)
            
            .on("mouseenter",function(e,i){
              d3.select(this).attr('r',6);
              d3.select(radarWrapper.selectAll(".radar-value")[0][i])
              .style("opacity","1")
              .transition()
              .style("top",function(){
                return d3.select(this).attr("data-top") - 5 + "px";
              });
            })
            .on("mouseleave",function(e,i){
              d3.select(this).attr('r',4);
              d3.select(radarWrapper.selectAll(".radar-value")[0][i])
              .style("opacity",null)
              .transition()
              .style("top",function(){
                return d3.select(this).attr("data-top") + "px";
              })
            })
            .transition()
            .duration(6*this.animationTime)
            .style("opacity",1)
        },
        fixArray:function(arr){
          var radarR = this.radarR;
          if ( arr.length < 6 ){
            for( var i = arr.length - 1; i<6; i++){
                arr.push(radarR+','+radarR);
            }
          }
          return arr;
        },
        buildPolygon:function(radarItemList, pointsArr, modify){
            var radarWrapper = this.radarWrapper;
            var radarR = this.radarR;
            var animationTime = this.animationTime;
            var PI = this.PI;
            var svg = radarWrapper.select("#radar-svg");
           
            this.radarPolygon = svg.selectAll(".radar-polygon")
            /*if(modify){
              this.radarPolygon.transition().attr("points",(pointsArr).join(" "))
              return;
            }*/
            this.radarPolygon
            .data([pointsArr.join(" ")]).enter()
            .append("polygon")
            .classed("radar-polygon",true)
            .attr("stroke","#eee")
            .attr("stroke-width",1)
            .style("fill","#eee")
            .style("opacity",.8)
             .on("mouseenter",function(e,i){
              radarWrapper.selectAll(".radar-value")
              .style("opacity","1");
            })
            .on("mouseleave",function(e,i){
             radarWrapper.selectAll(".radar-value")
              .style("opacity",null);
            })
            .attr("points",this.fixArray([]).join(" "))
            .transition()
            .duration(animationTime)
            .attr("points",this.fixArray(pointsArr.slice(0,2)).join(" "))
            .transition()
            .duration(animationTime)
            .attr("points",this.fixArray(pointsArr.slice(0,3)).join(" "))
            .transition()
            .duration(animationTime)
            .attr("points",this.fixArray(pointsArr.slice(0,4)).join(" "))
            .transition()
            .duration(animationTime)
            .attr("points",this.fixArray(pointsArr.slice(0,5)).join(" "))
            .transition()
            .duration(animationTime)
            .attr("points",function(d){ return d; })
            .style("fill","#f89");
            //var valueR = (width + 25 );
            
        },
        buildRadarCircle:function(){
            //draw circle
            var radarR = this.radarR;
            var svg = this.radarWrapper.select("#radar-svg");
            this.radarCircles = svg.selectAll('.radar-circle')
            .data(this.radarCircleList)
            .order()
            .enter().append("circle")
            .attr("cx",radarR)
            .attr("cy",radarR)
            .attr("stroke","#eee")
            .attr("stroke-width",1)
            .attr("r",function(d){ return d; })
            .style("fill",function(d,i){ if( i%2 ){ return "#fff"; }else { return "#fefefe"; }})
            .style("opacity",0.4);
            
        },
        buildRadarLine:function(){
            //draw line
            var self = this;
            var radarR = this.radarR;
            var svg = this.radarWrapper.select("svg");
            this.radarLines = svg.selectAll(".radar-line")
            .data(this.angleList)
            .enter()
            .append("line")
            .attr("stroke","#ddd")
            .attr("stroke-width",1)
            .attr("x1",radarR)
            .attr("y1",radarR)
            .attr("x2",function(d,i){
              return Math.floor(radarR+Math.sin(d) * radarR);
            })
            .attr("y2",function(d,i){
              return Math.floor(radarR-Math.cos(d) * radarR);
            });
          
        },

        buildTimeLine:function(){
            //draw line
            var self = this;
            var timeLineWrapper = d3.select("#time-line");
            //timeLineWrapper.classed("time-line",true);
            timeLineWrapper.selectAll(".time-line-item")
            .data([
                {
                  type:"year", value: "2012", height: "29"
                },
                {
                  type:"year", value: "2013", height: "43"
                },
                {
                  type:"year", value: "2014", height: "50"
                },
                {
                  type:"year", value: "2015", height: "79"
                },
                {
                  type:"month", value: "1", height: "20"
                },
                {
                  type:"month", value: "2", height: "29"
                },
                {
                  type:"month", value: "3", height: "14"
                },
                {
                  type:"month", value: "4", height: "29"
                },
                {
                  type:"month", value: "5", height: "21"
                },
                {
                  type:"month", value: "6", height: "29"
                },
                {
                  type:"month", value: "7", height: "78"
                },
                {
                  type:"month", value: "8", height: "60"
                },
                {
                  type:"month", value: "9", height: "29"
                },
                {
                  type:"month", value: "10", height: "59"
                },
                {
                  type:"month", value: "11", height: "20"
                },
                {
                  type:"month", value: "12", height: "29"
                }
              ])
            .enter()
            .append("div")
            .attr("class",function(d) { 
                return "time-line-item time-line-item-" + d.type; 
              } 
            )
            
            .attr("data-type", function(d) { return d.type; } )
            .attr("data-value", function(d) { return d.value; })
            .style("height",function(d){
                return ''+ d.height+'px';
            })
            .html(function(d){
                
                return '<div class="time-line-tip time-line-tip-' + d.type +'" >'
                + (d.value+ ( d.type == "year" ? "年" : "月")) 
                +'</div>';                
            })
            .on("mouseenter",function(e,i){
                var Dthis = d3.select(this);
                Dthis.select(".time-line-tip")
                .style("display","block")
            })
            .on("mouseleave",function(e,i){
                var Dthis = d3.select(this);
                Dthis.select(".time-line-tip")
                .style("display","none")
            });
        }

     };
      
     var Builder =  new radarBuilder(radarItemList);
      
      
    </script>
  </body>
</html>
